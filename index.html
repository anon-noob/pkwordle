<!DOCTYPE html>
<html>
    <head>
        <style>
        body {
            background: #fff;
            color: #111;
        }
        @media (prefers-color-scheme: dark) {
            body {
            background: #181818;
            color: #eee;
            }
        }
        </style>
        <title>pkworlde</title>
    </head>

    <body>
        <h1>Parkour Wordle</h1>
        <h3>Instructions</h3>
        <p>You have 6 attempts to guess a 3-to-10-letter word that is related to parkour.</p>
        <p><span style="font-weight:bold; color: green">Green</span> letters mean the letter is in the right place. <span style="font-weight:bold; color: gold">Yellow</span> letters mean the letter is in the wrong place. <span style="font-weight:bold; color: gray">Gray</span> letters mean the word doesn't contain (any more of) those letters.</p>
        <p>The rightmost tile will be <span style="font-weight:bold; color: green">green</span> if the length of the word is correct, otherwise it will be <span style="font-weight:bold; color: red">red</span>.</p>
    </body>
    
    <main>
        <table id="table">
            <thead>
                <tr>
                    <th colspan="11">Parkour Wordle</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
                <tr>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="cell-btn" disabled></button></td>
                    <td><button class="length-btn" disabled></button></td>
                </tr>
            </tbody>
        </table>
        <style>
        .cell-btn {
            width: 40px;
            height: 40px;
            font-size: 1.3em;
            font-weight: bold;
            border: 2px solid #bbb;
            border-radius: 6px;
            background: #fff;
            color: #111;
            margin: 2px;
            text-transform: uppercase;
            pointer-events: none;
        }
        @media (prefers-color-scheme: dark) {
            .cell-btn {
                background: #222;
                color: #eee;
                border-color: #444;
            }
        }
        .length-btn {
            width: 40px;
            height: 40px;
            font-size: 1.3em;
            font-weight: bold;
            border: 2px solid #bbb;
            border-radius: 6px;
            background: #ffffff9d;
            color: #393939;
            margin: 2px;
            text-transform: uppercase;
            pointer-events: none;
        }

        @media (prefers-color-scheme: dark) {
            .length-btn {
                background: #363636;
                color: #eee;
                border-color: #444;
            }
        }

        </style>

        <form method="get" onsubmit="handleSubmit(event)">
            <input id="input-field" type="text" pattern="[a-zA-Z]+" minlength="3" maxlength="10" placeholder="Your word (3-10 characters)" required>
            <input id="submit" type="submit" name="submit" value="Enter">
        </form>
        
        <div id="keyboard" style="margin-top:20px;">
            <div>
                <button type="button" class="key" onclick="pressKey('Q')">Q</button>
                <button type="button" class="key" onclick="pressKey('W')">W</button>
                <button type="button" class="key" onclick="pressKey('E')">E</button>
                <button type="button" class="key" onclick="pressKey('R')">R</button>
                <button type="button" class="key" onclick="pressKey('T')">T</button>
                <button type="button" class="key" onclick="pressKey('Y')">Y</button>
                <button type="button" class="key" onclick="pressKey('U')">U</button>
                <button type="button" class="key" onclick="pressKey('I')">I</button>
                <button type="button" class="key" onclick="pressKey('O')">O</button>
                <button type="button" class="key" onclick="pressKey('P')">P</button>
            </div>
            <div>
                <button type="button" class="key" onclick="pressKey('A')">A</button>
                <button type="button" class="key" onclick="pressKey('S')">S</button>
                <button type="button" class="key" onclick="pressKey('D')">D</button>
                <button type="button" class="key" onclick="pressKey('F')">F</button>
                <button type="button" class="key" onclick="pressKey('G')">G</button>
                <button type="button" class="key" onclick="pressKey('H')">H</button>
                <button type="button" class="key" onclick="pressKey('J')">J</button>
                <button type="button" class="key" onclick="pressKey('K')">K</button>
                <button type="button" class="key" onclick="pressKey('L')">L</button>
            </div>
            <div>
                <button type="button" class="key" onclick="pressKey('Backspace')">⌫</button>
                <button type="button" class="key" onclick="pressKey('Z')">Z</button>
                <button type="button" class="key" onclick="pressKey('X')">X</button>
                <button type="button" class="key" onclick="pressKey('C')">C</button>
                <button type="button" class="key" onclick="pressKey('V')">V</button>
                <button type="button" class="key" onclick="pressKey('B')">B</button>
                <button type="button" class="key" onclick="pressKey('N')">N</button>
                <button type="button" class="key" onclick="pressKey('M')">M</button>
                <button type="button" class="key" onclick="pressKey('Enter')">⏎</button>
            </div>
        </div>
        <script>
        function pressKey(key) {
            const input = document.getElementById('input-field');
            if (input.disabled) return;
            if (key === 'Backspace') {
                input.value = input.value.slice(0, -1);
            } else if (key === 'Enter') {
                document.querySelector('form').requestSubmit();
            } else if (input.value.length < 5 && /^[A-Z]$/.test(key)) {
                input.value += key.toLowerCase();
            }
            input.focus();
        }
        </script>
        <style>
        #keyboard .key {
            width: 36px;
            height: 40px;
            margin: 2px;
            font-size: 1.1em;
            border-radius: 4px;
            border: 1px solid #bbb;
            background: #eee;
            cursor: pointer;
            user-select: none;
        }
        #keyboard {
            display: inline-block;
            text-align: center;
        }
        #keyboard div {
            margin-bottom: 4px;
        }
        </style>
    
        <div id="result"></div>
        <div id="count"></div>
        <div id="extra"></div>
        <div id="time until next word"></div>

        <div id="share-display">
            <button id="share" onclick="shareToClipboard()" disabled>Share</button>
            <p id="clipboard"></p>            
        </div>

        <script>
let maxWordLength = 10;
let guessHistory = {};
let guessStatistics = {"green":0, "yellow":0, "gray":0, "length_red":0, "length_green":0};
let gameState = "active";
let guessCount = 0;
let solution = "angle";
let validWords;

function readTextFile() {
    return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    validWords = xhr.responseText;
                    resolve(validWords);
                } else {
                    reject(new Error(`Failed to load the file. Status: ${xhr.status}`));
                }
            }
        };

        xhr.open('GET', 'words_alpha.txt', true);
        xhr.send();
    });
}

readTextFile()
.then((value) => {
        console.log(`Loaded dictionary`);
        console.log(`The solution has been decided`);
        console.log(`Looking at console is not going to help`);
        console.log(`Nor does typing 'solution' for the answer`);
        return Promise.resolve();

    })
    .catch((error) => {
        console.error(error);
    });

let words = ['0x58541283804c', '0x5a24cd629f6b', '0x5dc81f9b3e54', '0x960b15c1feb', '0xa781dac7e73', '0x68b076d38b8c', '0x585235332a05', '0x68b19fe53e2c', '0x593cabbbb42c', '0xe8c375f0a0', '0x9498ca8666d', '0x94963bd16c3', '0x8ec41ea9e83', '0xae94bd7f1fa', '0x5f98dae5217c', '0x593b45ed316c', '0x68afc34bfb24', '0x68b341b98d74', '0xa78469df454', '0x90377a8d4d6', '0x5a2278be24ec', '0x90377a8e478', '0x68b128ecde25', '0x5a241a923d74', '0xa0076d76418', '0x65f581dc72f4', '0xa78469de0da', '0xa323d8a4bc5', '0x1105d6693c5', '0xa3226914ca0', '0x699aecb4063a', '0x585236180014', '0x98c0c84c893', '0xa320eaf4b71', '0x68b0b1b73e6d', '0x65f493253661', '0x977d019a653', '0xe6c359a91d', '0x9493a0b90dd', '0xa7841839a9c', '0x616d13f45c80', '0x94975ac755d', '0x5eb041bc1881', '0x68af1123b078', '0x1001122b17f', '0x67c63c6f1fbc', '0x2a15c3855', '0x2b40baec3', '0x253dfbf9d', '0x38d4fdf29b47b', '0x449c3c86', '0x1b7f9cf655', '0x248cafcbc', '0x1b08673f3a', '0x16d7b2e198', '0x248bbba76', '0x2ad47fa5b', '0x18b5129578', '0x6901220', '0x19a289b8b8', '0x8aeb0ed3392b852c', '0x606b5ff', '0x198f5db9e944e64', '0x2cb15578b', '0x26b6dad48c63fa', '0x27575e49f1b5137d3ca', '0x18e47021c000506', '0x51fbc7bbce003eb995df8c', '0x26c7f006c', '0x6aeae0c', '0x5d8e76c', '0x238452836e4afc', '0x1acd18e78f', '0x26a8b1a2c506d89a1fa', '0x171e0813e9cd6fa', '0x21df1deb2d20fb35a86', '0xa1babd', '0x40f3af19', '0xb5bc36', '0x171aecd1d0070f8e6a75', '0x55d9f485fe07826f4', '0x6cd49f6', '0xa33995', '0x5439aaacdbc36fe6d', '0x28e5bfea13bb15', '0x26ffc6a5ce6af89df8c', '0x55d9f485fe0780f8c', '0x87259b49df2459873f78c', '0x25fc16d38cbedb7378c', '0x27d4b7d50fbab8', '0x9b95de8552d491b8', '0x63d92238ca3335784', '0x6900277', '0x47822829', '0x51291b85c621275a854fd9', '0x1a7257772a10eac', '0x1967878148', '0x5b2b227840443541d', '0x28f7aa4fb', '0x6cd0b80', '0x192beca3c8', '0xa7cd80', '0x43b51366960c5', '0x416effc9ee0c5', '0xb27bd8', '0x198ee92e0bda384', '0x91de9c01b13a63e5', '0x2005b2fd679bd549e68bf064', '0x271ad2886', '0x985adb5aed76bd6261654', '0x98571ff7b337112eef42c', '0x64b72dc117cabef3c', '0x613e54cf58a62dcfe', '0x198f3206e306548', '0x605f66044fbd8e578', '0x28d88f8be0d638', '0x5f359b4d64bafa326e2bec', '0x18603d502d66745401f6', '0x171aecf1c97a9e092364', '0x6120cf7aff731b605', '0x3a898c9d9a057', '0x352f3c50917d79cffd', '0x56f1eeeb76266943d85f89', '0x186074d31238ffb3ba57', '0x38d3b60f09fb4', '0x55f4dda0921412257', '0x2ae207455', '0x198ef7cdf872a05', '0x23910d9a886fc5', '0x19c8529d49e9c45', '0x2a23c536c', '0xa320eaf4b71', '0x186005f0e9eb8d65a0eb', '0x63d83f21ba7138235', '0x18ab6c5f25ea9bc', '0x169ccf329b', '0x90668c35c9c76eed17cfe', '0x185fdc27a101ba019df8', '0x2700bb3a17c4455a874', '0x22db27746448dd', '0x187317a09fb7cfe', '0x19567737276d14d', '0x271e8c400d88bd', '0x2439dca61dad1b1d34691b64', '0x68b0761c708c', '0x6aeb9bf', '0x29050391e', '0x265c15ad4', '0x1674034c96f4104', '0x62559bc', '0x9a32f4170cb43674', '0x29f550430add0a', '0x634849c', '0x18e4c7752d15646', '0x973a4fe693162257', '0x9cc7696cfd69913a', '0xe709ffaadd2120d2b324', '0x5dc344ae577f10b64', '0x23942d73ed35b872a38b852c', '0x3644601e314a7dccdd', '0x2a829109f', '0x2584ce27a13a6b9aa1de7646', '0x6dc6531', '0x9b96ee2cecda13dd', '0x167042096802848c36e584e64', '0x21eb83b11385434446e', '0x1accfa4b98', '0x22edea377d07c14c89d17646', '0x1787665ec45e6ab5e655', '0x3e060d0b3b2e56f6660a4ec', '0x62f789a611bccd41d', '0x18296edb25291a271fd5', '0x26681a3c9a6e7a'];

let today = new Date();
let utcDate = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate()));
let nextMidnight = new Date(Date.UTC(today.getUTCFullYear(), today.getUTCMonth(), today.getUTCDate() + 1));
let seed = utcDate.getTime() / 86400000;
function seededRandom(seed) {
        // Mulberry32 PRNG
        var t = seed += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
    };
// let randIndex = Math.floor(Math.random(seed) * words.length); //debug purposes (or if u wanna have infinite fun)
let randIndex = Math.floor(seededRandom(seed) * words.length);

function toChar(str) {
    code = "";
    finalResult = "";
    for (char of str) {
        code += char;
        if (96 < Number(code) && Number(code) < 123) {
            finalResult += String.fromCharCode(code);
            code = "";
        }
    }
    return finalResult
}

function validParkourWord(word) {
    let l = []
    for (const element of words) {
        l.push(toChar(BigInt(element).toString()))
    }
    return l.includes(word)
}

// Update keyboard colors
function updateKeyboardColors(guessHistory, guessCount) {
    const keyButtons = document.querySelectorAll('.key');
    // Track best color for each letter
    const keyColors = {};
    for (let i = 1; i <= guessCount; i++) {
        for (let j = 0; j < maxWordLength; j++) {
            const emoji = guessHistory[i][j];
            const letter = table.rows[i].cells[j].textContent.toUpperCase();
            if (!/^[A-Z]$/.test(letter)) continue;
            if (emoji === "🟩") {
                keyColors[letter] = "green";
            } else if (emoji === "🟨" && keyColors[letter] !== "green") {
                keyColors[letter] = "gold";
            } else if (emoji === "⬛" && !keyColors[letter]) {
                keyColors[letter] = "gray";
            }
        }
    }
    keyButtons.forEach(btn => {
        const letter = btn.textContent.trim().toUpperCase();
        if (keyColors[letter]) {
            btn.style.background = keyColors[letter];
            btn.style.color = (keyColors[letter] === "gray") ? "#fff" : "#000";
        } else {
            btn.style.background = "#eee";
            btn.style.color = "#000";
        }
    });
}


function handleSubmit(event) {
    event.preventDefault()
    
    let trueSol = toChar(BigInt(words[randIndex]).toString());

    // get elements
    var inputField = document.getElementById('input-field');
    var displayDiv = document.getElementById('result');

    var inputData = inputField.value.toLowerCase();

    if (!validWords.includes(inputData) && !validParkourWord(inputData)) {
        displayDiv.innerHTML = `<span style='color:red'>${inputData} is not a valid word</span>`;
        return;
    }

    // reset input field
    inputField.value = "";

    let charPos = {};
    for (let i = 0; i < maxWordLength; i++) {
        charPos[i] = inputData[i];
    }

    let charCount = {};
    for (let char of trueSol) {
        charCount[char] = (charCount[char] || 0) + 1;
    }

    guessCount++;
    guessHistory[guessCount] = {0:"", 1:"", 2:"", 3:"", 4:"", 5:"", 6:"", 7:"", 8:"", 9:""};

    var displayCount = document.getElementById('count');
    if (guessCount === 1) {
        displayCount.textContent = `You guessed ${guessCount} time`
    } else {
        displayCount.textContent = `You guessed ${guessCount} times`
    }

    // display the input
    displayDiv.textContent = `You typed ${inputData}`;
    
    let table = document.getElementById("table");    
    // The Main Calculations
    
    let btn = table.rows[guessCount].cells[maxWordLength].querySelector('button')
    if (trueSol.length != inputData.length) {
        btn.style.background = "red";
        guessStatistics["length_red"]++;
    } else {
        btn.style.background = "green";
        guessStatistics["length_green"]++;
    }
    
    // green letters
    for (let i = 0; i < inputData.length; i++) {
        if (trueSol[i] === inputData[i]) {
            let btn = table.rows[guessCount].cells[i].querySelector('button');
            btn.textContent = inputData[i].toUpperCase();
            // try {btn.textContent = inputData[i].toUpperCase();} catch {}
            btn.style.color = "white";
            btn.style.background = "green";
            btn.style.fontSize = "2em";
            charCount[inputData[i]]--;
            guessHistory[guessCount][i] = "🟩";
            guessStatistics["green"]++;
            delete charPos[i];
        }
    }
    

    // win
    if (inputData === trueSol) {
        gameState = "win"
        result();
        updateKeyboardColors(guessHistory, guessCount);
        return
    }

    // yellow and gray letters
    Object.entries(charPos).forEach(([index, char]) => {
        let btn = table.rows[guessCount].cells[index].querySelector('button');
        try {btn.textContent = char.toUpperCase();} catch {}
        btn.style.fontSize = "2em";
        if (trueSol.includes(char) && charCount[char] > 0) {
            btn.style.color = "black";
            btn.style.background = "gold";
            charCount[char]--;
            guessHistory[guessCount][index] = "🟨";
            guessStatistics["yellow"]++;
        } else if (index < inputData.length) {
            btn.style.color = "white";
            btn.style.background = "gray";
            guessHistory[guessCount][index] = "⬛";
            guessStatistics["gray"]++;
        }
    });
    updateKeyboardColors(guessHistory, guessCount);

    // lose
    if (guessCount === 6) {
        gameState = "lose";
        result();
        return
    }
}

function result() {
    document.getElementById('input-field').disabled = true;
    document.getElementById('submit').disabled = true;
    document.getElementById('share').disabled = false;

    switch (gameState) {
        case "win":
            var displayCount = document.getElementById('count');
            displayCount.textContent = `Win! Took ${guessCount} guesses.`
            break;
        
        case "lose":
            var displayCount = document.getElementById('count');
            displayCount.textContent = `Lose! Word was ${toChar(BigInt(words[randIndex]).toString())}.`
            break;
    }

    // banter
    switch (guessCount) {
        case 1:
            document.getElementById("extra").textContent = "Then if a player that can cheat but cannot be proven, then he is not a cheater.";
            break;
        case 2:
            document.getElementById("extra").textContent = "I think you got lucky, or had a really good first guess";
            break;
        case 3:
            document.getElementById("extra").textContent = "Amazingly executed!";
            break;
        case 4:
            document.getElementById("extra").textContent = "Great job!"
            break;
        case 5:
            document.getElementById("extra").textContent = "Not bad.";
            break;
        case 6:
            if (gameState === "win") {
                document.getElementById("extra").textContent = "Phew, thought i needed to call the mods.";
            } else {
                document.getElementById("extra").textContent = "I'm calling the discord mods; they might banish you to manacube!!!";
            }
            break;
    }

    function updateCountdown() {
        const now = new Date();
        const diff = nextMidnight - now;
        if (diff > 0) {
            const hours = String(Math.floor(diff / 3600000)).padStart(2, '0');
            const minutes = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
            const seconds = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
            document.getElementById("time until next word").textContent = `Next word in ${hours}:${minutes}:${seconds}`;
        } else {
            document.getElementById("time until next word").textContent = "New word available, refresh to play again!";
        }
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);
    
}

function shareToClipboard() {
    let text = 'Parkour Wordle ';

    if (gameState === "win") {
        text += `${guessCount}/6\n`;
    } else if (gameState === "lose") {
        text += `Failed\n`;
    }

    // Object.values(guessHistory).forEach( (colors) => {
    //     Object.values(colors).forEach((emoji) => {

    //         text += emoji;
    //     })

    //     text += "\n";
    // })

    text += `Letters: ${guessStatistics.green}x 🟩 - ${guessStatistics.yellow}x 🟨\nLength:  ${guessStatistics.length_green}x 🟩 - ${guessStatistics.length_red}x 🟥\n`

    text += "https://anon-noob.github.io/pkwordle/";

    navigator.clipboard.writeText(text);
    document.getElementById("clipboard").textContent = "Copied to clipboard!";
}
        </script>


    </main>

    <br>
</html>
